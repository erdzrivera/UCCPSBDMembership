<abp-modal [(visible)]="visible" (visibleChange)="close()"
    [options]="{size: 'xl', centered: true, modalClass: 'premium-modal'}">
    <ng-template #abpHeader>
        <div class="d-flex align-items-center w-100">
            <i class="fas fa-user-plus fs-4 me-3"></i>
            <div>
                <h4 class="mb-0 fw-bold">{{ (memberId ? '::Edit Member' : '::Add New Member') | abpLocalization }}</h4>
                <small class="opacity-75" style="font-size: 0.85rem;" *ngIf="!memberId">Register a new member to the
                    database</small>
                <small class="opacity-75" style="font-size: 0.85rem;" *ngIf="memberId">Update existing member
                    information</small>
            </div>
        </div>
    </ng-template>

    <ng-template #abpBody>
        <div class="card-header bg-white border-bottom-0 pt-2 px-2 mb-3">
            <ul class="nav nav-tabs card-header-tabs" style="border-bottom: 2px solid #f0f0f0;">
                <li class="nav-item">
                    <a class="nav-link" [class.active]="activeTab === 'personal'" (click)="activeTab = 'personal'"
                        role="button" style="cursor: pointer;"
                        [ngStyle]="activeTab === 'personal' ? {'border-bottom': '3px solid #198754', 'color': '#198754', 'font-weight': '600'} : {'color': '#6c757d'}">
                        <i class="fas fa-user-circle me-2"></i> Personal Info
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" [class.active]="activeTab === 'family'" (click)="activeTab = 'family'"
                        role="button" style="cursor: pointer;"
                        [ngStyle]="activeTab === 'family' ? {'border-bottom': '3px solid #198754', 'color': '#198754', 'font-weight': '600'} : {'color': '#6c757d'}">
                        <i class="fas fa-users me-2"></i> Family & Background
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" [class.active]="activeTab === 'baptism'" (click)="activeTab = 'baptism'"
                        role="button" style="cursor: pointer;"
                        [ngStyle]="activeTab === 'baptism' ? {'border-bottom': '3px solid #198754', 'color': '#198754', 'font-weight': '600'} : {'color': '#6c757d'}">
                        <i class="fas fa-water me-2"></i> Baptismal Info
                    </a>
                </li>
            </ul>
        </div>

        <form [formGroup]="form" (ngSubmit)="save()" *ngIf="form" class="px-2">
            <!-- Professional Note about inaccuracies -->
            <div class="alert bg-success-subtle border-0 text-success d-flex align-items-center mb-4" role="alert">
                <i class="fas fa-info-circle me-2"></i>
                <small>Required fields are marked with an asterisk (*). Ensure all information is verified against
                    official documents.</small>
            </div>

            <!-- Tab 1: Identity & Church -->
            <div *ngIf="activeTab === 'personal'" class="animate__animated animate__fadeIn">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2"
                        style="width: 32px; height: 32px;">
                        <i class="fas fa-id-card small"></i>
                    </div>
                    <h6 class="mb-0 text-dark fw-bold">Identity & Church</h6>
                </div>

                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label small fw-bold text-muted mb-1">FIRST NAME *</label>
                        <input type="text" class="form-control" formControlName="firstName"
                            placeholder="Enter first name"
                            [class.is-invalid]="form.get('firstName')?.invalid && form.get('firstName')?.touched" />
                    </div>
                    <div class="col-md-4">
                        <label class="form-label small fw-bold text-muted mb-1">MIDDLE NAME</label>
                        <input type="text" class="form-control" formControlName="middleName" placeholder="Optional" />
                    </div>
                    <div class="col-md-4">
                        <label class="form-label small fw-bold text-muted mb-1">LAST NAME *</label>
                        <input type="text" class="form-control" formControlName="lastName" placeholder="Enter last name"
                            [class.is-invalid]="form.get('lastName')?.invalid && form.get('lastName')?.touched" />
                    </div>
                    <div class="col-md-4">
                        <label class="form-label small fw-bold text-muted mb-1">ORGANIZATION *</label>
                        <select class="form-control" formControlName="organizationId"
                            [class.is-invalid]="form.get('organizationId')?.invalid && form.get('organizationId')?.touched">
                            <option [ngValue]="null">Select Organization</option>
                            <option *ngFor="let org of organizations" [ngValue]="org.abbreviation">
                                {{ org.name }} ({{ org.abbreviation }})
                            </option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label small fw-bold text-muted mb-1">MEMBERSHIP TYPE *</label>
                        <select class="form-control" formControlName="memberTypeId"
                            [class.is-invalid]="form.get('memberTypeId')?.invalid && form.get('memberTypeId')?.touched">
                            <option [ngValue]="null">Select Type</option>
                            <option *ngFor="let type of membershipTypes" [ngValue]="type.name">{{ type.name }}</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label small fw-bold text-muted mb-1">ACCOUNT STATUS</label>
                        <div class="form-check form-switch mt-2">
                            <input class="form-check-input" type="checkbox" formControlName="isActive"
                                id="isActiveModal">
                            <label class="form-check-label fw-bold ms-2 text-secondary" for="isActiveModal"
                                style="font-size: 0.9rem;">Still Active Member</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 2: Life & Family -->
            <div *ngIf="activeTab === 'family'" class="animate__animated animate__fadeIn">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center me-2"
                        style="width: 32px; height: 32px;">
                        <i class="fas fa-home small"></i>
                    </div>
                    <h6 class="mb-0 text-dark fw-bold">Life & Family</h6>
                </div>

                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label small fw-bold text-muted mb-1">BIRTHDAY *</label>
                        <input type="date" class="form-control" formControlName="birthday"
                            [class.is-invalid]="form.get('birthday')?.invalid && form.get('birthday')?.touched" />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label small fw-bold text-muted mb-1">PLACE OF BIRTH</label>
                        <input type="text" class="form-control" formControlName="placeOfBirth"
                            placeholder="City, Province" />
                    </div>
                    <div class="col-md-12">
                        <label class="form-label small fw-bold text-muted mb-1">OCCUPATION</label>
                        <input type="text" class="form-control" formControlName="occupation"
                            placeholder="Current profession" />
                    </div>
                    <div class="col-md-6 border-top pt-3">
                        <label class="form-label small fw-bold text-muted mb-1">FATHER'S NAME</label>
                        <input type="text" class="form-control" formControlName="fatherName" placeholder="Full name" />
                    </div>
                    <div class="col-md-6 border-top pt-3">
                        <label class="form-label small fw-bold text-muted mb-1">MOTHER'S NAME</label>
                        <input type="text" class="form-control" formControlName="motherName" placeholder="Full name" />
                    </div>
                </div>
            </div>

            <!-- Tab 3: Baptismal Records -->
            <div *ngIf="activeTab === 'baptism'" class="animate__animated animate__fadeIn">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-info text-white rounded-circle d-flex align-items-center justify-content-center me-2"
                        style="width: 32px; height: 32px;">
                        <i class="fas fa-water small"></i>
                    </div>
                    <h6 class="mb-0 text-dark fw-bold">Baptismal Records</h6>
                </div>

                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label small fw-bold text-muted mb-1">BAPTISM DATE</label>
                        <input type="date" class="form-control" formControlName="baptismDate" />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label small fw-bold text-muted mb-1">OFFICIATING MINISTER</label>
                        <input type="text" class="form-control" formControlName="baptizedBy"
                            placeholder="Name of minister" />
                    </div>
                    <div class="col-12">
                        <label class="form-label small fw-bold text-muted mb-1">SPONSORS</label>
                        <textarea class="form-control" formControlName="sponsors" rows="5"
                            placeholder="Enter list of sponsors"></textarea>
                    </div>
                </div>
            </div>
        </form>
    </ng-template>

    <ng-template #abpFooter>
        <div class="d-flex justify-content-between w-100 p-2">
            <button type="button" class="btn btn-light border px-4 hstack gap-2" (click)="close()">
                <i class="fas fa-times"></i>
                <span>{{ '::Cancel' | abpLocalization }}</span>
            </button>
            <button type="button" class="btn btn-primary px-5 shadow-sm hstack gap-2" (click)="save()"
                [disabled]="form?.invalid">
                <i class="fas fa-save"></i>
                <span class="fw-bold">{{ (memberId ? '::Update Member' : '::Register Member') | abpLocalization
                    }}</span>
            </button>
        </div>
    </ng-template>
</abp-modal>