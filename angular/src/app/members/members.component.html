<div class="card border-0 shadow-sm">
  <div class="card-header bg-transparent py-4 px-4 d-flex justify-content-between align-items-center">
    <div>
      <h5 class="custom-page-title mb-0">
        <i class="fa fa-users me-2" style="color: #3a416f !important;"></i>
        {{ '::Members' | abpLocalization }}
      </h5>
      <small class="text-muted">Manage your organization's membership directory</small>
    </div>

    <button *abpPermission="'Membership.Members.Create'" id="create" class="btn btn-primary btn-sm px-4" type="button"
      (click)="createMember()">
      <i class="fa fa-plus me-1"></i>
      <span>{{ '::Add Member' | abpLocalization }}</span>
    </button>
  </div>

  <div class="card-body px-4">
    <!-- Filter Section (Standardized 2-Row, 4-Column Layout) -->
    <div class="row g-3 mb-4">
      <!-- Row 1 -->
      <div class="col-12 col-md-3">
        <label class="small text-muted fw-bold mb-1 d-block" style="font-size: 0.7rem;">LAST NAME</label>
        <div class="input-group input-group-sm">
          <input type="text" class="form-control border-end-0" placeholder="Filter by last name..."
            [(ngModel)]="lastName" (keyup)="list.get()">
          <span class="input-group-text bg-white border-start-0">
            <i class="fa fa-search text-muted"></i>
          </span>
        </div>
      </div>

      <div class="col-12 col-md-3">
        <label class="small text-muted fw-bold mb-1 d-block" style="font-size: 0.7rem;">FIRST NAME</label>
        <div class="input-group input-group-sm">
          <input type="text" class="form-control border-end-0" placeholder="Filter by first name..."
            [(ngModel)]="firstName" (keyup)="list.get()">
          <span class="input-group-text bg-white border-start-0">
            <i class="fa fa-search text-muted"></i>
          </span>
        </div>
      </div>

      <div class="col-12 col-md-3">
        <label class="small text-muted fw-bold mb-1 d-block" style="font-size: 0.7rem;">MIDDLE NAME</label>
        <div class="input-group input-group-sm">
          <input type="text" class="form-control border-end-0" placeholder="Filter by middle name..."
            [(ngModel)]="middleName" (keyup)="list.get()">
          <span class="input-group-text bg-white border-start-0">
            <i class="fa fa-search text-muted"></i>
          </span>
        </div>
      </div>

      <div class="col-12 col-md-3">
        <label class="small text-muted fw-bold mb-1 d-block" style="font-size: 0.7rem;">STATUS</label>
        <select class="form-select form-select-sm" [(ngModel)]="selectedStatus" (change)="list.get()">
          <option [ngValue]="null">{{ '::All Statuses' | abpLocalization }}</option>
          <option [ngValue]="true">{{ '::Active' | abpLocalization }}</option>
          <option [ngValue]="false">{{ '::Inactive' | abpLocalization }}</option>
        </select>
      </div>

      <!-- Row 2 -->
      <div class="col-12 col-md-3">
        <label class="small text-muted fw-bold mb-1 d-block" style="font-size: 0.7rem;">BIRTHDAY FROM</label>
        <div class="input-group input-group-sm">
          <input type="date" class="form-control border-end-0" [(ngModel)]="birthdayStart" (change)="list.get()">
          <span class="input-group-text bg-light border-start-0">
            <i class="fa fa-calendar text-muted"></i>
          </span>
        </div>
      </div>

      <div class="col-12 col-md-3">
        <label class="small text-muted fw-bold mb-1 d-block" style="font-size: 0.7rem;">BIRTHDAY TO</label>
        <div class="input-group input-group-sm">
          <input type="date" class="form-control border-end-0" [(ngModel)]="birthdayEnd" (change)="list.get()">
          <span class="input-group-text bg-light border-start-0">
            <i class="fa fa-calendar text-muted"></i>
          </span>
        </div>
      </div>

      <div class="col-12 col-md-3">
        <label class="small text-muted fw-bold mb-1 d-block" style="font-size: 0.7rem;">ORGANIZATION</label>
        <select class="form-select form-select-sm" [(ngModel)]="selectedOrg" (change)="list.get()">
          <option value="">{{ '::All Organizations' | abpLocalization }}</option>
          <option *ngFor="let org of organizations" [value]="org.id">{{ org.name }}</option>
        </select>
      </div>

      <div class="col-12 col-md-3">
        <label class="small text-muted fw-bold mb-1 d-block" style="font-size: 0.7rem;">MEMBER TYPE</label>
        <select class="form-select form-select-sm" [(ngModel)]="selectedType" (change)="list.get()">
          <option value="">{{ '::All Types' | abpLocalization }}</option>
          <option *ngFor="let type of memberTypes" [value]="type.id">{{ type.name }}</option>
        </select>
      </div>
    </div>

    <ngx-datatable [rows]="member.items" [count]="member.totalCount" [list]="list" default
      (activate)="onActivate($event)" class="material clickable-rows" [headerHeight]="50" [footerHeight]="50"
      [rowHeight]="'auto'">

      <!-- Reverted to Separate Columns for Sorting -->
      <ngx-datatable-column [name]="'::Last Name' | abpLocalization" prop="lastName" [width]="150">
        <ng-template let-row="row" ngx-datatable-cell-template>
          <span class="fw-bold">{{ row.lastName }}</span>
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column [name]="'::First Name' | abpLocalization" prop="firstName"
        [width]="150"></ngx-datatable-column>
      <ngx-datatable-column [name]="'::Middle Name' | abpLocalization" prop="middleName"
        [width]="120"></ngx-datatable-column>

      <ngx-datatable-column [name]="'::Birthday' | abpLocalization" prop="birthday" [width]="120">
        <ng-template let-row="row" ngx-datatable-cell-template>
          <div class="d-flex align-items-center">
            <i class="fa fa-calendar-alt me-2 text-muted" style="font-size: 0.8rem;"></i>
            {{ row.birthday | date:'mediumDate' }}
          </div>
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column [name]="'::Organization' | abpLocalization" prop="organizationId" [width]="100">
        <ng-template let-row="row" ngx-datatable-cell-template>
          <span class="badge"
            style="background-color: #f1f3f9 !important; color: #344767 !important; font-weight: 600;">{{
            row.organizationId || 'None' }}</span>
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column [name]="'::Member Type' | abpLocalization" prop="memberTypeId" [width]="100">
        <ng-template let-row="row" ngx-datatable-cell-template>
          <span class="badge"
            style="background-color: #e9ecef !important; color: #3a416f !important; font-weight: 600;">{{
            row.memberTypeId || 'None' }}</span>
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column [name]="'::Status' | abpLocalization" prop="isActive" [width]="100">
        <ng-template let-row="row" ngx-datatable-cell-template>
          <span class="badge" [ngClass]="row.isActive ? 'bg-success-light' : 'bg-danger-light'"
            [style.color]="row.isActive ? '#2dce89' : '#f5365c'"
            [style.background-color]="row.isActive ? '#e2f7ed' : '#fee6eb'" style="font-weight: 600;">
            {{ row.isActive ? 'Active' : 'Inactive' }}
          </span>
        </ng-template>
      </ngx-datatable-column>

    </ngx-datatable>
  </div>
</div>

<app-member-modal [(visible)]="isModalOpen" [memberId]="selectedMember.id" (saved)="onSaved()"></app-member-modal>